<!-- FOOTER -->
<footer style="border-top: 3px solid rgb(209, 0, 36); min-width: 400px">
    <!-- top footer -->
    <div style="background-color: rgb(21, 22, 29)">
        <div class="container">
            <div class="row">
                <div class="col-md-3 col-xs-6 text-center text-md-start">
                    <h3 class="mt-5 mb-3 my-md-4 fs-4 text-white">Về Chúng Tôi</h3>

                    <ul style="padding: 0; list-style-type: none">
                        <li class="py-2">
                            <a href="#" class="text-white text-decoration-none">Giới Thiệu Về Shop</a>
                        </li>
                        <li class="py-2">
                            <a href="#" class="text-white text-decoration-none">Tuyển Dụng</a>
                        </li>
                        <li class="py-2">
                            <a href="#" class="text-white text-decoration-none">Điều Khoản</a>
                        </li>
                        <li class="py-2">
                            <a href="#" class="text-white text-decoration-none">Chính Sách Bảo Mật</a>
                        </li>
                        <li class="py-2">
                            <a href="#" class="text-white text-decoration-none">Chính Hãng</a>
                        </li>
                        <li class="py-2">
                            <a href="#" class="text-white text-decoration-none">Kênh Người Bán</a>
                        </li>
                        <li class="py-2">
                            <a href="#" class="text-white text-decoration-none">Flash Sales</a>
                        </li>
                        <li class="py-2">
                            <a href="#" class="text-white text-decoration-none">Liên Hệ Với Truyền Thông</a>
                        </li>
                    </ul>
                    <ul style="padding: 0; list-style-type: none">
                        <li class="py-2">
                            <a href="#" class="text-white text-decoration-none">
                                <i class="fa-solid fa-location-dot text-white bg-transparent" style="color: rgb(209, 0, 36) !important"></i>
                                30/4 ĐH Cần Thơ</a>
                        </li>
                        <li class="py-2">
                            <a href="#" class="text-white text-decoration-none">
                                <i class="fa-solid fa-phone text-white bg-transparent" style="color: rgb(209, 0, 36) !important"></i>
                                +012-34-56-78
                            </a>
                        </li>
                        <li class="py-2">
                            <a href="#" class="text-white text-decoration-none">
                                <i class="fa-solid fa-envelope text-white bg-transparent" style="color: rgb(209, 0, 36) !important"></i>
                                email@email.com
                            </a>
                        </li>
                    </ul>
                </div>

                <div class="col-md-3 col-xs-6 text-center text-md-start">
                    <h3 class="mt-5 mb-3 my-md-4 fs-4 text-white">CSKH</h3>

                    <ul class="" style="padding: 0; list-style-type: none">
                        <li class="py-2">
                            <a href="#" class="text-white text-decoration-none">Trung Tâm Trợ Giúp</a>
                        </li>
                        <li class="py-2">
                            <a href="#" class="text-white text-decoration-none">Hướng Dẫn Mua Hàng</a>
                        </li>
                        <li class="py-2">
                            <a href="#" class="text-white text-decoration-none">Hướng Dẫn Bán Hàng</a>
                        </li>
                        <li class="py-2">
                            <a href="#" class="text-white text-decoration-none">Thanh Toán</a>
                        </li>
                        <li class="py-2">
                            <a href="#" class="text-white text-decoration-none">Vận Chuyển</a>
                        </li>
                        <li class="py-2">
                            <a href="#" class="text-white text-decoration-none">Trả Hàng & Hoàn Tiền</a>
                        </li>
                        <li class="py-2">
                            <a href="#" class="text-white text-decoration-none">Chăm Sóc Khách Hàng</a>
                        </li>
                        <li class="py-2">
                            <a href="#" class="text-white text-decoration-none">Chính Sách Bảo Hành</a>
                        </li>
                    </ul>
                </div>

                <div class="col-md-3 col-xs-6 text-center text-md-start">
                    <h3 class="mt-5 mb-3 my-md-4 fs-4 text-white">THANH TOÁN</h3>

                    <ul class="d-flex justify-content-center justify-content-md-start flex-wrap gap-3" style="padding: 0; list-style-type: none">
                        <li class="py-2">
                            <a href="#" class="fs-1 text-white text-decoration-none"><i class="fa-brands fa-cc-visa"></i></a>
                        </li>
                        <li class="py-2">
                            <a href="#" class="fs-1 text-white text-decoration-none"><i class="fa-brands fa-cc-amazon-pay"></i></a>
                        </li>
                        <li class="py-2">
                            <a href="#" class="fs-1 text-white text-decoration-none"><i class="fa-brands fa-cc-paypal"></i></a>
                        </li>
                        <li class="py-2">
                            <a href="#" class="fs-1 text-white text-decoration-none"><i class="fa-brands fa-cc-mastercard"></i></a>
                        </li>
                    </ul>
                </div>

                <div class="col-md-3 col-xs-6 text-center text-md-start">
                    <h3 class="mt-5 mb-3 my-md-4 fs-4 text-white">Các Dịch Vụ</h3>

                    <ul class="" style="padding: 0; list-style-type: none">
                        <li class="py-2">
                            <a href="#" class="text-white text-decoration-none">Tài khoản của tôi</a>
                        </li>
                        <li class="py-2">
                            <a href="#" class="text-white text-decoration-none">Giỏ Hàng</a>
                        </li>
                        <li class="py-2">
                            <a href="#" class="text-white text-decoration-none">Theo Dõi Đơn Hàng</a>
                        </li>
                        <li class="py-2">
                            <a href="#" class="text-white text-decoration-none">Trợ giúp</a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <!-- /top footer -->

    <!-- bottom footer -->
    <div style="background-color: rgb(30, 31, 41)">
        <div class="container">
            <div class="row">
                <div class="col-md-12 text-center text-white py-4">
                    <span class="copyright">
                        &copy; 2023 - Bản quyền thuộc về Công ty TTHH
                    </span>
                </div>
            </div>
        </div>
    </div>
    <!-- /bottom footer -->
</footer>
<!-- /FOOTER -->

<script type="text/javascript">
    $().ready(() => {
        const convertPriceToNumber = (price) => {
            const result = price.replace(/\D/g, '');
            return Number(result);
        }

        const convertNumberToPrice = (number) => {
            return Number(number).toLocaleString('vi', {
                style: 'currency',
                currency: 'VND'
            });
        }

        fetch('/cart/list', {
                method: 'POST',
            })
            .then(res => res.json())
            .then(data => {
                if (data.length === 0) {
                    const el = `<div style="height: 300px;" class="empty-cart d-flex justify-content-center align-items-center">
                                    <img src="/imgs/cart/empty-cart.png" class="w-25" alt="">
                                </div>`;
                    $('header .cart .cart-list').html(el);
                    return;
                }

                $('header .cart-quantity').html(data.length);

                $('header .cart .cart-list').html(
                    `<div class="contain overflow-x-hidden overflow-y-scroll rounded" style="max-height: 50vh"></div>`
                );

                let html = '';

                data.forEach(item => {
                    html += `
                        <a href="/product/${item.product_id}" class="product card flex-row border-0 p-3 text-decoration-none text-dark" data-product_id="${item.product_id}">
                            <img src="${item.thumbnail}" class="img-fluid" style=" height: 100px; width: 100px;" alt="..." />
                            <div class="card-body container">
                                <div class="row">
                                    <p class="card-text col-8 text-truncate">
                                       ${item.name}
                                    </p>
                                    <div class="d-flex align-items-center gap-1">
                                        <p class="fs-5 fw-bold" style="color: rgb(209, 0, 36)">
                                            ${convertNumberToPrice(item.price)}
                                        </p>
                                        <p style="color: rgb(209, 0, 36)">x<span class="quantity ms-1 fw-bold">${item.quantity}</span></p>
                                    </div>
                                </div>
                            </div>
                        </a>                       
                     `;
                })

                $('header .cart .cart-list div').html(html);
                $('header .cart .cart-list').append(`
                        <div class="pt-4 pb-3 text-end">
                            <a href="/cart" class="text-decoration-none btn text-white py-2 px-3 me-3" style="color: #fff !important; background-color: rgb(209, 0, 36)">
                                Xem giỏ hàng
                            </a>
                        </div>
                `);


            })
            .catch(error => {
                console.error("Error:", error);
            });

        $('.add-to-cart').each(function() {
            $(this).on('click', function() {
                const product = $(this).closest('.product');
                const productId = product[0].dataset.product_id;

                const formData = new FormData();

                formData.append('productId', productId);
                formData.append('quantity', 1);

                fetch('/cart', {
                        method: 'POST',
                        body: formData
                    })
                    .then(res => res.json())
                    .then(res => {
                        if ($('header .empty-cart').length) {
                            $('header .empty-cart').remove();

                            $('header .cart .cart-list').html(
                                `<div class="contain overflow-x-hidden overflow-y-scroll rounded" style="max-height: 50vh"></div>`
                            );

                            $('header .cart .cart-list').append(`
                                    <div class="pt-4 pb-3 text-end">
                                        <a href="/cart" class="text-decoration-none btn text-white py-2 px-3 me-3" style="color: #fff !important; background-color: rgb(209, 0, 36)">
                                            Xem giỏ hàng
                                        </a>
                                    </div>
                            `);
                        }

                        let isExist = false;
                        $('header .cart-list .product.card').each(function() {
                            const itemId = $(this).prop('href').split('/')[4];

                            if (itemId === productId) {
                                $(this).find('.quantity').html(Number($(this).find('.quantity').text()) + 1);
                                isExist = true;
                            }
                        })

                        const cartItem = `
                            <a href="/product/${productId}" class="product card flex-row border-0 p-3 text-decoration-none text-dark" data-product_id="${product.product_id}">
                                <img src="${product.find('img').prop('src')}" class="img-fluid" style=" height: 100px; width: 100px;" alt="..." />
                                <div class="card-body container">
                                    <div class="row">
                                        <p class="card-text col-8 text-truncate">
                                        ${product.find('.name').text()}
                                        </p>
                                        <div class="d-flex align-items-center gap-1">
                                            <p class="fs-5 fw-bold" style="color: rgb(209, 0, 36)">
                                                ${product.find('.price').text()}
                                            </p>
                                            <p style="color: rgb(209, 0, 36)">x<span class="quantity ms-1 fw-bold">1</span></p>
                                        </div>
                                    </div>
                                </div>
                            </a>                       
                        `;

                        if (!isExist) {
                            $('header .cart-list .contain').append(cartItem)
                        }

                        $('header .cart-quantity').html($('header .cart-list .product.card').length);

                        if ($(this).find('.no-alert').length) {
                            window.location.href = '/checkout';
                            return;
                        }

                        Swal.fire({
                            title: `${res["error"] ? 'Lỗi' : 'Thành công'}`,
                            text: res["message"],
                            icon: `${res["error"] ? 'error' : 'success'}`,
                            confirmButtonText: 'Ok',
                            customClass: {
                                confirmButton: `${res["error"] ? 'bg-danger' : 'bg-success'}`,
                            },
                        }).then(() => {
                            if (res['error'] === 2) {
                                window.location.href = '/login';
                            }
                        })
                    })
                    .catch(error => {
                        console.error("Error:", error);
                    });
            })
        })
    })
</script>

</body>

</html>